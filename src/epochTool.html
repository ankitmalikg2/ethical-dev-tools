<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Epoch Tool</title>
    <link rel="stylesheet" href="common-styles.css">
</head>
<body>
    <div class="edt-container">
        <h1 class="edt-title">Epoch Tool</h1>
        
        <div class="edt-current-time" id="currentTime">
            Current Unix Timestamp: <span id="currentEpoch"></span>
        </div>

        <div class="edt-section">
            <h2 class="edt-subtitle edt-subtitle--section">Convert Epoch to Human Readable</h2>
            <div class="edt-input-group">
                <label class="edt-label" for="epochInput">Unix Timestamp (seconds or milliseconds):</label>
                <input class="edt-input" type="text" id="epochInput" placeholder="e.g., 1640995200 or 1640995200000">
            </div>
            <button class="edt-button" onclick="convertEpochToHuman()">Convert to Date</button>
            <div class="edt-code edt-hidden" id="epochResult"></div>
        </div>

        <div class="edt-section">
            <h2 class="edt-subtitle edt-subtitle--section">Convert Human Readable to Epoch</h2>
            <div class="edt-input-group">
                <label class="edt-label" for="dateInput">Date (YYYY-MM-DD HH:MM:SS or ISO format):</label>
                <input class="edt-input" type="text" id="dateInput" placeholder="e.g., 2022-01-01 00:00:00 or 2022-01-01T00:00:00Z">
            </div>
            <button class="edt-button edt-mt-1" onclick="convertHumanToEpoch()">Convert to Epoch</button>
            <button class="edt-button edt-mt-1" onclick="useCurrentTime()">Use Current Time</button>
            <div class="edt-code edt-hidden" id="dateResult"></div>
        </div>
    </div>

    <script>
        function updateCurrentTime() {
            const now = Math.floor(Date.now() / 1000);
            document.getElementById('currentEpoch').textContent = now;
        }

        function convertEpochToHuman() {
            const epochInput = document.getElementById('epochInput').value.trim();
            const resultDiv = document.getElementById('epochResult');
            
            if (!epochInput) {
                resultDiv.classList.remove('edt-hidden');
                resultDiv.innerHTML = '<span style="color: var(--vscode-errorForeground);">Please enter an epoch timestamp</span>';
                return;
            }

            try {
                let timestamp = parseInt(epochInput);
                
                // If timestamp is in milliseconds (13 digits), convert to seconds
                if (timestamp.toString().length === 13) {
                    timestamp = timestamp / 1000;
                }
                
                const date = new Date(timestamp * 1000);
                
                if (isNaN(date.getTime())) {
                    throw new Error('Invalid timestamp');
                }

                const utcString = date.toUTCString();
                const isoString = date.toISOString();
                const localString = date.toString();
                
                resultDiv.classList.remove('edt-hidden');
                resultDiv.innerHTML = `<strong>Converted Date:</strong><br><strong>UTC:</strong> ${utcString}<br><strong>ISO:</strong> ${isoString}<br><strong>Local:</strong> ${localString}`;
            } catch (error) {
                resultDiv.classList.remove('edt-hidden');
                resultDiv.innerHTML = '<span style="color: var(--vscode-errorForeground);">Invalid epoch timestamp</span>';
            }
        }

        function convertHumanToEpoch() {
            const dateInput = document.getElementById('dateInput').value.trim();
            const resultDiv = document.getElementById('dateResult');
            
            if (!dateInput) {
                resultDiv.classList.remove('edt-hidden');
                resultDiv.innerHTML = '<span style="color: var(--vscode-errorForeground);">Please enter a date</span>';
                return;
            }

            try {
                const date = new Date(dateInput);
                
                if (isNaN(date.getTime())) {
                    throw new Error('Invalid date');
                }

                const epochSeconds = Math.floor(date.getTime() / 1000);
                const epochMilliseconds = date.getTime();
                
                resultDiv.classList.remove('edt-hidden');
                resultDiv.innerHTML = `<strong>Converted Epoch:</strong><br><strong>Seconds:</strong> ${epochSeconds}<br><strong>Milliseconds:</strong> ${epochMilliseconds}`;
            } catch (error) {
                resultDiv.classList.remove('edt-hidden');
                resultDiv.innerHTML = '<span style="color: var(--vscode-errorForeground);">Invalid date format</span>';
            }
        }

        function useCurrentTime() {
            const now = new Date();
            document.getElementById('dateInput').value = now.toISOString().slice(0, 19).replace('T', ' ');
        }

        // Update current time every second
        updateCurrentTime();
        setInterval(updateCurrentTime, 1000);
    </script>
</body>
</html>